(()=>{"use strict";function e(e){chrome.action.setBadgeText({text:e})}function t(t,n){""!==t.trim()&&chrome.storage.sync.get("tasks",(function(s){const o=s.tasks||[],a=Date.now(),i=Math.random().toString(36).substring(2,12);o.find((e=>e.text===t))||(o.unshift({text:t,website:n,timeAdded:a,id:i,type:"confirmed"}),chrome.storage.sync.set({tasks:o},(function(){o&&e(o.length.toString())})))}))}chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus.create({id:"addItemList",title:"Send to Side Panel",contexts:["selection"]}),chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}),chrome.storage.sync.get("tasks",(t=>{const n=t.tasks;n&&e(n.length.toString())}))})),chrome.contextMenus.onClicked.addListener((function(e){"addItemList"==e.menuItemId&&e.selectionText&&(t(e.selectionText.trim(),e.pageUrl),chrome.runtime.sendMessage({action:"updatePanel"}))})),chrome.commands.onCommand.addListener((e=>{"add-text-to-side-panel"===e&&chrome.tabs.query({active:!0,currentWindow:!0},(e=>{chrome.tabs.sendMessage(e[0].id,{action:"addToSidePanel"})}))})),chrome.runtime.onMessage.addListener(((e,n,s)=>{"sendUpdated"===e.action&&chrome.runtime.sendMessage({action:"updatePanel"}),"sendToContent"===e.action&&chrome.tabs.query({active:!0,currentWindow:!0},(e=>{chrome.tabs.sendMessage(e[0].id,{action:"highlightMatches"})})),"addToSidePanelByDrag"===e.action&&chrome.tabs.query({active:!0,currentWindow:!0},(([n])=>{t(e.selectedText,n.url),chrome.runtime.sendMessage({action:"updatePanel"})}))}))})();